name: ci

on:
        push:
                branches:
                        - main
                        - master
        pull_request:
                branches:
                        - main
                        - master

jobs:
        ci:
                runs-on: ${{ matrix.os }}

                strategy:
                        matrix:
                                os: [ubuntu-latest]
                                node: [14]

                steps:
                        - name: Checkout ğŸ›
                          uses: actions/checkout@master

                        - name: Setup node env ğŸ—
                          uses: actions/setup-node@v2.1.5
                          with:
                                  node-version: ${{ matrix.node }}
                                  check-latest: true

                        - name: Cache node_modules ğŸ“¦
                          uses: actions/cache@v3.0.5
                          with:
                                  path: ~/.npm
                                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                                  restore-keys: |
                                          ${{ runner.os }}-node-

                        - name: Install dependencies ğŸ‘¨ğŸ»â€ğŸ’»
                          run: npm ci --prefer-offline --no-audit

                        - name: Run linter ğŸ‘€
                          run: npm run lint

                        - name: Run tests ğŸ§ª
                          run: npm run test
                        - name: Building static
                          run: npm run generate
                        - name: Deploy to Server
                          uses: easingthemes/ssh-deploy@v2.2.11
                          env:
                                  SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
                                  ARGS: '-rltgoDzvO --delete'
                                  SOURCE: 'dist/'
                                  REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
                                  REMOTE_USER: ${{ secrets.REMOTE_USER }}
                                  REMOTE_PORT: ${{ secrets.REMOTE_PORT }}
                                  TARGET: ${{ secrets.REMOTE_TARGET }}
                                  EXCLUDE: '/dist/, /node_modules/'
